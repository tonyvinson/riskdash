output "api_gateway_rest_api_id" {
  description = "ID of the API Gateway REST API"
  value       = aws_api_gateway_rest_api.ksi_api.id
}

output "api_gateway_rest_api_arn" {
  description = "ARN of the API Gateway REST API"
  value       = aws_api_gateway_rest_api.ksi_api.arn
}

output "api_gateway_stage_arn" {
  description = "ARN of the API Gateway stage"
  value       = aws_api_gateway_stage.ksi_api.arn
}

output "api_gateway_invoke_url" {
  description = "The invoke URL for the API Gateway"
  value       = local.api_base_url
}

output "api_gateway_deployment_id" {
  description = "ID of the API Gateway deployment"
  value       = aws_api_gateway_deployment.ksi_api.id
}

output "api_lambda_function_arns" {
  description = "ARNs of API Lambda functions"
  value = {
    validate   = aws_lambda_function.api_validate.arn
    executions = aws_lambda_function.api_executions.arn
    results    = aws_lambda_function.api_results.arn
  }
}

output "api_lambda_function_names" {
  description = "Names of API Lambda functions"
  value = {
    validate   = aws_lambda_function.api_validate.function_name
    executions = aws_lambda_function.api_executions.function_name
    results    = aws_lambda_function.api_results.function_name
  }
}

output "api_endpoints" {
  description = "Available API endpoints"
  value = {
    validate_url   = "${local.api_base_url}/api/ksi/validate"
    executions_url = "${local.api_base_url}/api/ksi/executions"
    results_url    = "${local.api_base_url}/api/ksi/results"
  }
}

output "cloudwatch_log_groups" {
  description = "CloudWatch log groups for API components"
  value = {
    validate_logs    = aws_cloudwatch_log_group.api_validate_logs.name
    executions_logs  = aws_cloudwatch_log_group.api_executions_logs.name
    results_logs     = aws_cloudwatch_log_group.api_results_logs.name
    api_access_logs  = aws_cloudwatch_log_group.api_access_logs.name
  }
}

output "quick_reference" {
  description = "Quick reference for testing API endpoints"
  value = {
    base_url = local.api_base_url
    test_commands = {
      validate = "curl -X POST '${local.api_base_url}/api/ksi/validate' -H 'Content-Type: application/json' -d '{\"tenant_id\": \"test\", \"trigger_source\": \"manual\"}'"
      executions = "curl -X GET '${local.api_base_url}/api/ksi/executions'"
      results = "curl -X GET '${local.api_base_url}/api/ksi/results'"
    }
  }
}
